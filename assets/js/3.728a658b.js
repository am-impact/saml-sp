(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{393:function(t,e,a){t.exports=a.p+"assets/img/okta-create-app.bc671cd3.png"},394:function(t,e,a){t.exports=a.p+"assets/img/okta-choose-saml.6d03a37b.png"},395:function(t,e,a){t.exports=a.p+"assets/img/okta-general.f73a5c37.png"},396:function(t,e,a){t.exports=a.p+"assets/img/okta-general-2.63d38d39.png"},397:function(t,e,a){t.exports=a.p+"assets/img/okta-advanced-settings.d489a7a3.png"},398:function(t,e,a){t.exports=a.p+"assets/img/okta-attribute-settings.3246b3d1.png"},399:function(t,e,a){t.exports=a.p+"assets/img/okta-assign-users.38b75d25.png"},400:function(t,e,a){t.exports=a.p+"assets/img/craft-mapping-attributes.e22e3461.png"},419:function(t,e,a){"use strict";a.r(e);var s=a(54),r=Object(s.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"okta"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#okta"}},[t._v("#")]),t._v(" Okta")]),t._v(" "),s("h3",{attrs:{id:"create-the-craft-sp-provider-my-provider"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#create-the-craft-sp-provider-my-provider"}},[t._v("#")]),t._v(" Create the Craft SP Provider (My Provider)")]),t._v(" "),s("p",[t._v('Within Craft CMS, after the plugin is installed, on the control panel left side navigation\nclick SAML Service Provider > "My Provider". Click "Generate key pair" (under the Security tab), label the provider, and\nhit save.')]),t._v(" "),s("p",[t._v("Then go back to the provider you just created and click on the Metadata tab. Leave this browser tab open for easy access\nwhile configuring Okta.")]),t._v(" "),s("h3",{attrs:{id:"create-the-application"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#create-the-application"}},[t._v("#")]),t._v(" Create the Application")]),t._v(" "),s("p",[s("img",{attrs:{src:a(393),alt:"Create the Application"}})]),t._v(" "),s("h4",{attrs:{id:"general-settings"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#general-settings"}},[t._v("#")]),t._v(" General Settings")]),t._v(" "),s("p",[t._v("Name the application accordingly and choose SAML 2.0 application.")]),t._v(" "),s("p",[s("img",{attrs:{src:a(394),alt:"Choose SAML 2.0"}})]),t._v(" "),s("p",[s("img",{attrs:{src:a(395),alt:"Name the Application"}})]),t._v(" "),s("h5",[t._v("Configure SAML")]),t._v(" "),s("ul",[s("li",[t._v("Single sign on URL: Set this to your Craft SP (My Provider) Assertion Consumer Service (ACS) found on the Metadata tab.\n"),s("ul",[s("li",[t._v("For example, "),s("code",[t._v("https://your-craft-domain.com/sso/login/1f85b98a-125a-4f34-8daf-4325077c065e")])])])]),t._v(" "),s("li",[t._v("Audience URI (SP Entity ID): Set this to the SP entity ID")]),t._v(" "),s("li",[t._v("Default RelayState: You can leave this blank")]),t._v(" "),s("li",[t._v("Name ID format: can be left as blank")]),t._v(" "),s("li",[t._v("Application username: Setting this to the Okta username is a good idea because if the user ever changes their email, their user in Craft will stay the same.")]),t._v(" "),s("li",[t._v('Update application username on: You can leave this as "Create and update"')])]),t._v(" "),s("p",[s("img",{attrs:{src:a(396),alt:"Name the Application"}})]),t._v(" "),s("h5",[t._v("Advanced Setting")]),t._v(" "),s("ul",[s("li",[t._v("Response: Signed")]),t._v(" "),s("li",[t._v("Assertion Signature: Signed")]),t._v(" "),s("li",[t._v("Signature Algorithm: leave on default")]),t._v(" "),s("li",[t._v("Digest Algorithm: leave on default")]),t._v(" "),s("li",[t._v("Assertion Encryption: For elevated security you can choose to encrypt but for this example, we'll leave as unencrypted due to us signing the Response and Assertion.")]),t._v(" "),s("li",[t._v("Enable Single Logout: Checked\n"),s("ul",[s("li",[t._v("Single Logout URL: Set this to your Craft SP (My Provider) Single Logout Service URL found on the Metadata tab.\n"),s("ul",[s("li",[t._v("For example, "),s("code",[t._v("https://your-craft-domain.com/sso/logout/1f85b98a-125a-4f34-8daf-4325077c065e")])])])]),t._v(" "),s("li",[t._v("SP Issuer: set as the Entity ID (same as the Entity ID set above)")]),t._v(" "),s("li",[t._v("Signature Certificate: Download from the Craft SP (My Provider) Security Tab, in Craft, and hit upload.")])])]),t._v(" "),s("li",[t._v("Assertion Inline Hook: leave as is")]),t._v(" "),s("li",[t._v("Honor Force Authentication: leave as is")]),t._v(" "),s("li",[t._v("SAML Issuer ID: leave as is")])]),t._v(" "),s("p",[s("img",{attrs:{src:a(397),alt:"Advanced Settings"}})]),t._v(" "),s("h5",[t._v("Attribute Statement")]),t._v(" "),s("p",[t._v("These are the attributes sent over in the assertion. All of the attributes sent over from here can be mapped to the Craft user.\nAt the minimum, email is required. But for this example, we'll do first and last name as well.")]),t._v(" "),s("ul",[s("li",[t._v("Under the first attribute statement:\n"),s("ul",[s("li",[t._v("Name: "),s("code",[t._v("FirstName")]),t._v(" ( ðŸ‘ˆ this is what the Craft plugin will see as the attribute name)")]),t._v(" "),s("li",[t._v("Name format: leave as is (unspecified)")]),t._v(" "),s("li",[t._v("Value: "),s("code",[t._v("user.firstName")])])])]),t._v(" "),s("li",[t._v("Under the second attribute statement:\n"),s("ul",[s("li",[t._v("Name: "),s("code",[t._v("LastName")])]),t._v(" "),s("li",[t._v("Name format: leave as is (unspecified)")]),t._v(" "),s("li",[t._v("Value: "),s("code",[t._v("user.lastName")])])])]),t._v(" "),s("li",[t._v("Under the third attribute statement:\n"),s("ul",[s("li",[t._v("Name: "),s("code",[t._v("Email")])]),t._v(" "),s("li",[t._v("Name format: leave as is (unspecified)")]),t._v(" "),s("li",[t._v("Value: "),s("code",[t._v("user.email")])])])])]),t._v(" "),s("p",[s("img",{attrs:{src:a(398),alt:"Attribute Statement"}})]),t._v(" "),s("h5",[t._v("Group Attribute Statements (optional)")]),t._v(" "),s("p",[t._v("Here's where you can send over group data and sync it to Craft. For now, we'll skip this step.")]),t._v(" "),s("h5",[t._v("Feedback")]),t._v(" "),s("p",[t._v("Just click Finish")]),t._v(" "),s("h4",{attrs:{id:"assign-users"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#assign-users"}},[t._v("#")]),t._v(" Assign Users")]),t._v(" "),s("p",[t._v('In Okta, on the application page for your newly created application, click the assignments tab, then the "Assign" and\nassign users or groups as needed.')]),t._v(" "),s("p",[s("img",{attrs:{src:a(399),alt:"Assign users"}})]),t._v(" "),s("h3",{attrs:{id:"copy-over-the-metadata-from-okta"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#copy-over-the-metadata-from-okta"}},[t._v("#")]),t._v(" Copy Over the Metadata (From Okta)")]),t._v(" "),s("p",[t._v('After you click the "Finish" button on the Feedback page, there\'s a button on the right side column labeled\n"View SAML setup instructions". At the bottom of the page copy the XML in the "Optional" (Provide the following IDP metadata to your SP provider) field.')]),t._v(" "),s("p",[t._v("Then run through the following step:")]),t._v(" "),s("ul",[s("li",[t._v('Within Craft CMS, goto the SAML Service Provider plugin and click "Provider List" > "+ Add Identity Provider"')]),t._v(" "),s("li",[t._v("On the provider page, Label the provider as needed (i.e., Okta Production) and paste the XML Metadata from Okta into the "),s("code",[t._v("2. Metadata XML")]),t._v(" on the Metadata field")]),t._v(" "),s("li",[t._v("Then, click on the Configure tab and setup the Mapping at the bottom as below (this will mirror what we configured in Okta):\n"),s("ul",[s("li",[t._v('Click on the "+ Add a new mapping" for first name:\n'),s("ul",[s("li",[t._v("Attribute Name: "),s("code",[t._v("FirstName")])]),t._v(" "),s("li",[t._v('Select "First Name" from the dropdown')])])]),t._v(" "),s("li",[t._v("Continue to last name:\n"),s("ul",[s("li",[t._v("Attribute Name: "),s("code",[t._v("LastName")])]),t._v(" "),s("li",[t._v('Select "Last Name"')])])]),t._v(" "),s("li",[t._v("Add email\n"),s("ul",[s("li",[t._v("Attribute Name: "),s("code",[t._v("Email")])]),t._v(" "),s("li",[t._v('Select "Email"')])])])])]),t._v(" "),s("li",[t._v("Click Save")])]),t._v(" "),s("p",[s("img",{attrs:{src:a(400),alt:"Mapping Attributes"}})]),t._v(" "),s("h3",{attrs:{id:"finish-and-test"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#finish-and-test"}},[t._v("#")]),t._v(" Finish and Test")]),t._v(" "),s("p",[t._v("Copy the UID from the new Okta and add/replace the "),s("code",[t._v("loginPath")]),t._v(" value in Craft's "),s("code",[t._v("config/general.php")]),t._v(" file, with this\nformat "),s("code",[t._v("/sso/login/request/<okta-uid>")]),t._v(".")]),t._v(" "),s("p",[t._v("For example:")]),t._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token php language-php"}},[s("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'loginPath'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'/sso/login/request/f2885601-e655-49ac-a2c5-48e702db6bfa'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),s("p",[t._v("To test, create a protected test page using like the following:")]),t._v(" "),s("div",{staticClass:"language-twig extra-class"},[s("pre",{pre:!0,attrs:{class:"language-twig"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token ld"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{%")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("requireLogin")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token rd"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("%}")])])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token ld"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{{")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("currentUser")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("fullName")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token rd"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}}")])])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token ld"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{{")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("currentUser")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("email")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token rd"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}}")])])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token ld"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{{")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("currentUser")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("username")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token rd"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}}")])])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token ld"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{{")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("currentUser")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("dateCreate")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token rd"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}}")])])]),t._v("\n")])])]),s("p",[t._v("Use an incognito tab or signed out from Craft, goto your newly created page and you be should redirected to the Okta (the IdP). Login\nand see that you will be returned back to the newly created page.")])])}),[],!1,null,null,null);e.default=r.exports}}]);